#N canvas 818 375 608 410 10;
#X declare -path lib;
#X obj 310 10 namecanvas \$1;
#X obj 86 77 cnv 15 81 38 empty \$0-learn-mode empty 20 12 0 14 #e0e0e0
#202020 0;
#X obj 270 58 cnv 15 33 179 empty empty empty 20 12 0 14 #e0e0e0 #404040
0;
#X obj 30 242 raptor;
#X obj 46 267 unpack f f;
#X floatatom 46 291 5 0 0 0 - - -, f 5;
#X floatatom 83 291 5 0 0 0 - - -, f 5;
#X floatatom 124 291 5 0 0 0 - - #0-tick, f 5;
#X obj 81 340 tgl 15 0 empty empty empty 17 7 0 10 #fcfcfc #000000
#000000 0 1;
#X obj 310 27 raptor-panel \$0;
#X obj 280 58 vradio 15 0 0 20 \$0-presetno-set \$0-presetno empty
0 -8 0 10 #fcfcfc #000000 #000000 0;
#X msg 144 250 4 4;
#X msg 174 250 3 4;
#N canvas 694 510 450 300 meter 0;
#X obj 30 190 list prepend meter;
#X obj 30 215 list trim;
#X obj 30 30 inlet;
#X obj 30 55 list split 2;
#X obj 30 160 list append;
#X obj 64 80 route bang;
#X msg 64 108 1;
#X text 100 110 default division is 1;
#X obj 30 240 s all-arp;
#X obj 80 30 r \$0-meter;
#X connect 0 0 1 0;
#X connect 1 0 8 0;
#X connect 2 0 3 0;
#X connect 3 0 4 0;
#X connect 3 1 5 0;
#X connect 4 0 0 0;
#X connect 5 0 6 0;
#X connect 5 1 4 1;
#X connect 6 0 4 1;
#X connect 9 0 3 0;
#X restore 174 290 pd meter;
#X msg 204 250 4 4 3;
#X msg 130 340 90;
#X msg 160 340 120;
#X msg 190 340 160;
#N canvas 432 513 450 300 tempo 0;
#X obj 30 85 list trim;
#X obj 30 30 inlet;
#X obj 30 60 list prepend tempo;
#X obj 30 110 s all-arp;
#X connect 0 0 3 0;
#X connect 1 0 2 0;
#X connect 2 0 0 0;
#X restore 160 370 pd tempo;
#X text 260 34 presets;
#X msg 30 162 reset;
#X msg 30 141 panic;
#X msg 30 183 reload;
#X msg 30 120 stop;
#X text 90 120 special ops;
#X text 153 318 tempo (bpm);
#X floatatom 220 340 5 30 960 0 - #0-tempo-sync -, f 5;
#X obj 150 216 meter-examples;
#N canvas 1062 297 509 614 time 0;
#X obj 40 20 inlet;
#X obj 230 20 tgl 15 1 empty \$0-master-toggle M 17 7 0 10 #fcfcfc
#000000 #000000 1 1;
#X obj 40 143 bng 15 50 10 0 pulse empty empty 17 7 0 10 #fcfcfc #000000
#000000;
#X obj 350 44 tgl 15 0 empty \$0-metro empty 17 7 0 10 #fcfcfc #000000
#000000 1 1;
#X obj 170 120 != 0;
#X obj 260 120 == 0;
#X obj 170 145 s \$0-master;
#X obj 260 145 s \$0-slave;
#X obj 40 200 r \$0-master;
#X obj 170 200 r \$0-slave;
#X text 40 170 - master -;
#X text 170 170 - slave -;
#X obj 230 255 sel \$0;
#X msg 263 280 0;
#X obj 350 70 spigot;
#X obj 282 20 bng 15 100 10 0 empty pulse empty 17 7 0 10 #fcfcfc #202020
#202020;
#X obj 170 255 spigot;
#X msg 170 280 1;
#X obj 401 320 s \$0-me;
#X obj 170 230 r \$0-me;
#X obj 282 43 outlet;
#X obj 230 230 r all-master;
#X obj 170 310 s \$0-master-toggle;
#X obj 170 70 change -1;
#X obj 40 310 s all-master;
#X obj 40 260 sel 1;
#X obj 40 285 f \$0;
#X obj 240 430 sel 1;
#X obj 350 265 t f f f b;
#X msg 384 350 set \$1;
#X obj 384 375 s \$0-play;
#X obj 91 100 r \$0-tick;
#X obj 40 365 midiclock;
#X obj 40 230 t f f f;
#X obj 65 390 s \$0-ms;
#X obj 40 390 bng 15 100 50 0 pulse empty empty 17 7 0 10 #fcfcfc #000000
#000000;
#X obj 120 390 tgl 15 0 empty empty empty 17 7 0 10 #fcfcfc #000000
#000000 0 1;
#X floatatom 140 497 5 0 0 0 - - -, f 5;
#X msg 140 521 color \$1 12 12;
#X msg 120 467 13;
#X obj 120 440 sel 1 0;
#X obj 140 546 s pulse;
#X msg 160 467 0;
#X obj 350 240 spigot 1;
#X obj 350 95 spigot 1;
#X obj 190 440 == 0;
#X obj 40 340 r \$0-m;
#X obj 90 340 r \$0-n;
#X floatatom 185 19 3 -24 24 0 - #0-pos -, f 3;
#X obj 240 457 bng 15 250 50 0 empty empty empty 17 7 0 10 #fcfcfc
#000000 #000000;
#X obj 240 480 spigot;
#X obj 273 457 tgl 15 1 empty empty empty 17 7 0 10 #fcfcfc #000000
#000000 1 1;
#X text 170 340 SPP - set the pulse number;
#X obj 240 505 s \$0-pos;
#X obj 185 401 s all-arp;
#X obj 212 358 r \$0-n;
#X obj 120 413 t f f f;
#X text 300 420 just leave this enabled \, in case your DAW doesn't
send SPP messages - it simply resends the pulse counter before starting
playback \, so it shouldn't do any harm even if your DAW *does* support
SPP, f 30;
#X obj 256 20 tgl 15 1 empty \$0-clkin S 17 7 0 10 #fcfcfc #000000
#000000 1 1;
#X obj 90 260 &&;
#X obj 100 230 t b f;
#N canvas 390 308 451 326 setup 0;
#X obj 260 20 r query-master;
#X obj 260 45 spigot;
#X obj 260 70 f \$0;
#X obj 260 95 s reply-master;
#X obj 360 20 inlet;
#X obj 40 20 inlet;
#X obj 40 45 pack f f;
#X msg 40 70 \$2 \$1;
#X obj 85 20 tgl 15 0 empty empty empty 17 7 0 10 #fcfcfc #000000 #000000
1 1;
#X obj 40 210 outlet;
#X obj 40 95 route 0 1;
#X obj 40 120 t f b b;
#X obj 59 150 s query-master;
#X obj 260 155 sel \$0;
#X msg 293 180 0;
#X obj 260 130 r reply-master;
#X obj 40 180 spigot 1;
#X obj 293 205 t f f;
#X obj 293 230 s \$0-master-toggle;
#N canvas 214 282 450 300 meter 0;
#X obj 40 80 r \$0-meter-num;
#X obj 40 105 route set;
#X obj 140 105 route set;
#X obj 140 80 r \$0-meter-denom;
#X obj 40 170 s \$0-n;
#X obj 140 170 s \$0-m;
#X obj 250 105 route set;
#X obj 250 80 r \$0-division;
#X obj 250 130 t b b f f;
#X obj 140 130 * 1;
#X obj 40 130 * 1;
#X connect 0 0 1 0;
#X connect 1 0 10 0;
#X connect 1 1 10 0;
#X connect 2 0 9 0;
#X connect 2 1 9 0;
#X connect 3 0 2 0;
#X connect 6 0 8 0;
#X connect 7 0 6 0;
#X connect 8 0 10 0;
#X connect 8 1 9 0;
#X connect 8 2 10 1;
#X connect 8 3 9 1;
#X connect 9 0 5 0;
#X connect 10 0 4 0;
#X restore 150 50 pd meter;
#X connect 0 0 1 0;
#X connect 1 0 2 0;
#X connect 2 0 3 0;
#X connect 4 0 1 1;
#X connect 5 0 6 0;
#X connect 6 0 7 0;
#X connect 7 0 10 0;
#X connect 8 0 6 1;
#X connect 10 0 11 0;
#X connect 10 1 9 0;
#X connect 11 0 16 0;
#X connect 11 1 12 0;
#X connect 11 2 8 0;
#X connect 13 1 14 0;
#X connect 14 0 17 0;
#X connect 15 0 13 0;
#X connect 16 0 9 0;
#X connect 17 0 18 0;
#X connect 17 1 16 1;
#X restore 170 50 pd setup;
#X obj 40 122 metro 500;
#X obj 185 380 mod 4;
#X obj 350 290 s \$0-metro;
#X obj 210 20 tgl 15 0 empty \$0-play empty 17 7 0 10 #fcfcfc #000000
#000000 1 1;
#X obj 170 90 t f f;
#X obj 350 120 t f f;
#X obj 350 150 sel 0;
#X msg 350 175 stop;
#X obj 350 200 s all-arp;
#N canvas 180 698 450 300 tempo 0;
#X floatatom 20 70 5 0 0 0 - - -, f 5;
#X floatatom 20 119 5 0 0 0 - - -, f 5;
#X obj 20 150 f;
#X obj 20 20 inlet;
#X obj 70 20 inlet;
#X obj 20 230 outlet;
#X obj 120 20 inlet;
#X obj 20 94 expr 60000/$f1*4/$f2;
#X obj 180 20 inlet;
#X floatatom 80 200 5 0 0 0 - - -, f 5;
#X obj 180 45 bng 15 250 50 0 empty empty empty 17 7 0 10 #fcfcfc #000000
#000000;
#X obj 80 175 expr rint($f1);
#X obj 80 150 smooth 5;
#X text 200 100 We do another final smoothing step and round to integer
bpm values here \, in order to deal with the seemingly inevitable jitter
in the MIDI clocks. The argument of smooth is the filter coefficient.
Larger values reduce jitter at the cost of increased response times.
5 seems to be a good value on my Linux system \, but YMMV., f 37;
#X obj 80 70 loadbang;
#X msg 80 125 120;
#X connect 0 0 7 0;
#X connect 1 0 12 0;
#X connect 2 0 5 0;
#X connect 3 0 0 0;
#X connect 4 0 2 0;
#X connect 6 0 7 1;
#X connect 7 0 1 0;
#X connect 8 0 10 0;
#X connect 9 0 2 1;
#X connect 10 0 12 1;
#X connect 11 0 9 0;
#X connect 12 0 11 0;
#X connect 14 0 15 0;
#X connect 15 0 12 0;
#X restore 40 473 pd tempo;
#X obj 100 440 tgl 15 1 empty empty empty 17 7 0 10 #fcfcfc #000000
#000000 1 1;
#X floatatom 40 498 5 0 0 0 - - -, f 5;
#X obj 40 520 spigot;
#X obj 40 547 s \$0-tempo-sync;
#X text 30 440 tempo sync;
#X connect 0 0 65 0;
#X connect 1 0 61 0;
#X connect 3 0 14 0;
#X connect 4 0 6 0;
#X connect 5 0 7 0;
#X connect 8 0 33 0;
#X connect 9 0 16 1;
#X connect 12 1 13 0;
#X connect 13 0 22 0;
#X connect 14 0 44 0;
#X connect 15 0 20 0;
#X connect 16 0 17 0;
#X connect 17 0 22 0;
#X connect 19 0 16 0;
#X connect 21 0 12 0;
#X connect 23 0 66 0;
#X connect 25 0 26 0;
#X connect 26 0 24 0;
#X connect 27 0 49 0;
#X connect 28 0 64 0;
#X connect 28 1 27 0;
#X connect 28 2 29 0;
#X connect 28 3 18 0;
#X connect 29 0 30 0;
#X connect 31 0 62 1;
#X connect 32 0 35 0;
#X connect 32 1 34 0;
#X connect 32 1 71 0;
#X connect 32 2 36 0;
#X connect 32 3 53 0;
#X connect 33 0 25 0;
#X connect 33 1 14 1;
#X connect 33 1 61 1;
#X connect 33 2 59 0;
#X connect 35 0 71 1;
#X connect 36 0 56 0;
#X connect 36 0 71 3;
#X connect 37 0 38 0;
#X connect 38 0 41 0;
#X connect 39 0 37 0;
#X connect 40 0 39 0;
#X connect 40 1 42 0;
#X connect 42 0 37 0;
#X connect 43 0 28 0;
#X connect 44 0 67 0;
#X connect 45 0 43 1;
#X connect 45 0 44 1;
#X connect 46 0 32 0;
#X connect 46 0 71 2;
#X connect 47 0 32 1;
#X connect 48 0 63 0;
#X connect 49 0 50 0;
#X connect 50 0 53 0;
#X connect 51 0 50 1;
#X connect 55 0 63 1;
#X connect 56 0 40 0;
#X connect 56 1 45 0;
#X connect 56 2 27 0;
#X connect 56 2 68 0;
#X connect 58 0 60 0;
#X connect 59 0 32 2;
#X connect 60 0 59 0;
#X connect 60 1 59 1;
#X connect 61 0 23 0;
#X connect 62 0 2 0;
#X connect 63 0 54 0;
#X connect 65 0 43 0;
#X connect 66 0 4 0;
#X connect 66 1 5 0;
#X connect 67 0 68 0;
#X connect 67 1 62 0;
#X connect 68 0 69 0;
#X connect 69 0 70 0;
#X connect 71 0 73 0;
#X connect 72 0 74 1;
#X connect 73 0 74 0;
#X connect 74 0 75 0;
#X coords 0 -1 1 1 167 21 1 135 17;
#X restore 30 30 pd time;
#N canvas 325 568 450 325 input 0;
#X obj 20 20 midi-input;
#X obj 20 60 r \$0-arp;
#X obj 20 40 r all-arp;
#X obj 20 190 outlet;
#X obj 20 110 inlet;
#N canvas 735 555 450 300 args 0;
#X obj 20 30 loadbang;
#X obj 20 85 del 300;
#X obj 20 140 list append \$1;
#X obj 20 165 sel 0;
#X msg 20 200 preset \$1;
#X obj 20 110 t b b;
#X obj 120 140 f \$2;
#X obj 120 165 sel 0;
#X msg 120 200 outchan \$1;
#X obj 20 260 outlet;
#X obj 20 55 t b b;
#X obj 200 225 spigot;
#X obj 200 30 list append \$1;
#X obj 200 55 sel 0;
#X msg 227 80 1;
#X obj 200 200 r \$1-arp;
#X connect 0 0 10 0;
#X connect 1 0 5 0;
#X connect 2 0 3 0;
#X connect 3 1 4 0;
#X connect 4 0 9 0;
#X connect 5 0 2 0;
#X connect 5 1 6 0;
#X connect 6 0 7 0;
#X connect 7 1 8 0;
#X connect 8 0 9 0;
#X connect 10 0 1 0;
#X connect 10 1 12 0;
#X connect 11 0 9 0;
#X connect 12 0 13 0;
#X connect 13 1 14 0;
#X connect 14 0 11 1;
#X connect 15 0 11 0;
#X restore 40 150 pd args;
#X obj 120 20 r \$0-midi-learn;
#X obj 120 45 tgl 15 0 empty empty empty 17 7 0 10 #fcfcfc #000000
#000000 0 1;
#X obj 120 68 sel 0 1;
#X msg 120 93 10;
#X msg 120 118 color \$1 12;
#X obj 120 143 s \$0-learn-mode;
#X msg 150 93 6;
#X obj 20 80 r \$0-myarp;
#X connect 0 0 3 0;
#X connect 1 0 3 0;
#X connect 2 0 3 0;
#X connect 4 0 3 0;
#X connect 5 0 3 0;
#X connect 6 0 7 0;
#X connect 7 0 8 0;
#X connect 8 0 9 0;
#X connect 8 1 12 0;
#X connect 9 0 10 0;
#X connect 10 0 11 0;
#X connect 12 0 10 0;
#X connect 13 0 3 0;
#X restore 30 210 pd input;
#N canvas 411 510 450 325 output 0;
#X obj 20 190 midi-output;
#X obj 20 130 spigot;
#X obj 20 155 print out;
#X obj 20 20 inlet;
#X obj 80 20 inlet;
#X obj 20 70 s \$0-loopcheck;
#X obj 20 100 t a a;
#X obj 200 70 unpack f f f;
#X obj 200 100 sel 0;
#X obj 200 125 s \$0-loopstart;
#X obj 300 100 change;
#X obj 300 125 s \$0-loopcounter;
#X obj 20 45 route loopcheck loopsize loopcounter;
#X obj 130 130 t b f;
#X obj 200 180 s \$0-loopsize;
#X msg 200 155 set \$1;
#X obj 130 180 s \$0-loop;
#X msg 130 155 1;
#X connect 1 0 2 0;
#X connect 3 0 12 0;
#X connect 4 0 1 1;
#X connect 6 0 1 0;
#X connect 6 1 0 0;
#X connect 7 0 8 0;
#X connect 7 1 10 0;
#X connect 8 0 9 0;
#X connect 10 0 11 0;
#X connect 12 0 5 0;
#X connect 12 1 13 0;
#X connect 12 2 7 0;
#X connect 12 3 6 0;
#X connect 13 0 17 0;
#X connect 13 1 15 0;
#X connect 15 0 14 0;
#X connect 17 0 16 0;
#X restore 30 370 pd output;
#X obj 207 82 bng 25 250 50 0 \$0-play empty empty 17 7 0 10 #fcfcfc
#000000 #000000;
#X msg 30 80 learn;
#X msg 30 100 unlearn;
#X text 93 90 MIDI learn;
#N canvas 255 485 450 300 init 0;
#X obj 200 56 pd-remote;
#X msg 200 30 pdluax reload;
#N canvas 857 77 450 300 preset 0;
#X floatatom 180 100 5 1 12 0 - - -, f 5;
#X msg 180 125 preset \$1;
#X obj 180 149 s \$0-arp;
#X obj 180 70 + 1;
#X obj 180 30 inlet;
#X obj 20 30 inlet;
#X obj 20 55 route float;
#X obj 83 100 pack s;
#X connect 0 0 1 0;
#X connect 1 0 2 0;
#X connect 3 0 0 0;
#X connect 4 0 3 0;
#X connect 5 0 6 0;
#X connect 6 0 3 0;
#X connect 6 1 7 0;
#X connect 7 0 1 0;
#X restore 20 92 pd preset;
#X floatatom 20 70 5 0 99 0 - - -, f 5;
#X obj 200 100 declare -path lib;
#X obj 71 30 r \$0-presetno-set;
#X connect 1 0 0 0;
#X connect 3 0 2 0;
#X connect 5 0 2 1;
#X restore 100 370 pd init;
#X obj 182 77 cnv 15 70 38 empty empty Raptor7 9 17 0 14 #ffffff #404040
0;
#X text 193 108 (c) 2024;
#N canvas 309 227 462 516 looper 0;
#X floatatom 40 82 3 0 99 0 - - -, f 3;
#X obj 70 82 bng 15 250 50 0 empty \$0-loop-file load/save 17 7 0 10
#e0e0e0 #202020 #202020;
#X obj 260 40 r \$0-loop;
#X obj 260 65 route set;
#X obj 260 90 != 0;
#X obj 260 115 tgl 15 0 empty empty empty 17 7 0 10 #fcfcfc #000000
#000000 0 1;
#X floatatom 280 277 5 0 0 0 - - -, f 5;
#X msg 280 301 color \$1 12 12;
#X obj 260 220 sel 1 0;
#X msg 300 247 0;
#X obj 280 326 s \$0-loop-file;
#X obj 330 40 r \$0-arp;
#X obj 330 65 route loop;
#X obj 170 40 r \$0-preset;
#X symbolatom 170 65 10 0 0 0 - - -, f 10;
#X obj 126 66 bng 15 150 10 0 empty \$0-loopstart empty 17 7 0 10 #a0a0a0
#202020 #202020;
#X floatatom 102 65 3 0 0 0 - #0-loopcounter -, f 3;
#X obj 30 106 t b f;
#N canvas 650 217 453 353 filename 0;
#X obj 40 80 symbol;
#X obj 40 105 pack s f;
#X msg 40 130 symbol \$1-\$2;
#X obj 40 20 inlet;
#X obj 120 20 inlet;
#X obj 80 20 inlet;
#X obj 40 180 outlet;
#X obj 40 155 makefilename data/%s.loop;
#X connect 0 0 1 0;
#X connect 1 0 2 0;
#X connect 2 0 7 0;
#X connect 3 0 0 0;
#X connect 4 0 0 1;
#X connect 5 0 1 1;
#X connect 7 0 6 0;
#X restore 70 190 pd filename;
#X msg 70 215 loop \$1 2;
#X obj 70 240 s \$0-myarp;
#N canvas 165 240 458 431 filename 0;
#X obj 40 80 symbol;
#X obj 40 105 pack s f;
#X msg 40 130 symbol \$1-\$2;
#X obj 40 20 inlet;
#X obj 120 20 inlet;
#X obj 80 20 inlet;
#X obj 40 180 outlet;
#X obj 40 155 makefilename data/%s.loop;
#X connect 0 0 1 0;
#X connect 1 0 2 0;
#X connect 2 0 7 0;
#X connect 3 0 0 0;
#X connect 4 0 0 1;
#X connect 5 0 1 1;
#X connect 7 0 6 0;
#X restore 70 106 pd filename;
#X msg 70 131 loop \$1;
#X text 130 131 load/save;
#X text 140 215 check;
#X obj 260 168 pack f f;
#X obj 330 90 r \$0-loopcheck;
#X obj 330 115 t b f;
#X obj 260 193 route 0 1;
#X obj 340 220 sel 1 0;
#X msg 260 247 10;
#X obj 170 89 t b a;
#X msg 340 247 13;
#X obj 70 156 t b a;
#X obj 340 168 change;
#X obj 260 138 t f f;
#X obj 340 193 bng 15 250 50 0 empty empty empty 17 7 0 10 #fcfcfc
#000000 #000000;
#X msg 380 247 14;
#X connect 0 0 17 0;
#X connect 0 0 21 1;
#X connect 1 0 21 0;
#X connect 2 0 3 0;
#X connect 3 0 4 0;
#X connect 3 1 4 0;
#X connect 4 0 5 0;
#X connect 5 0 35 0;
#X connect 6 0 7 0;
#X connect 7 0 10 0;
#X connect 8 0 30 0;
#X connect 8 1 9 0;
#X connect 9 0 6 0;
#X connect 11 0 12 0;
#X connect 12 0 4 0;
#X connect 13 0 14 0;
#X connect 14 0 31 0;
#X connect 17 0 18 0;
#X connect 17 1 18 1;
#X connect 18 0 19 0;
#X connect 19 0 20 0;
#X connect 21 0 22 0;
#X connect 22 0 33 0;
#X connect 25 0 28 0;
#X connect 26 0 27 0;
#X connect 27 0 25 0;
#X connect 27 1 25 1;
#X connect 28 0 8 0;
#X connect 28 1 29 0;
#X connect 29 0 32 0;
#X connect 29 1 37 0;
#X connect 30 0 6 0;
#X connect 31 0 0 0;
#X connect 31 1 18 2;
#X connect 31 1 21 2;
#X connect 32 0 6 0;
#X connect 33 0 18 0;
#X connect 33 1 20 0;
#X connect 34 0 36 0;
#X connect 35 0 25 0;
#X connect 35 1 34 0;
#X connect 36 0 18 0;
#X connect 37 0 6 0;
#X coords 0 -1 1 1 107 36 1 36 64;
#X restore 140 160 pd looper;
#X connect 3 0 30 0;
#X connect 3 1 4 0;
#X connect 3 2 7 0;
#X connect 4 0 5 0;
#X connect 4 1 6 0;
#X connect 8 0 30 1;
#X connect 11 0 13 0;
#X connect 12 0 13 0;
#X connect 14 0 13 0;
#X connect 15 0 18 0;
#X connect 16 0 18 0;
#X connect 17 0 18 0;
#X connect 20 0 29 0;
#X connect 21 0 29 0;
#X connect 22 0 29 0;
#X connect 23 0 29 0;
#X connect 26 0 18 0;
#X connect 27 0 13 0;
#X connect 28 0 29 0;
#X connect 29 0 3 0;
#X connect 32 0 29 0;
#X connect 33 0 29 0;
